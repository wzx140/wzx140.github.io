---
layout: post
title:  "æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–ç®—æ³•"
date:   2018-12-21
categories: MachineLearning
tags: DeepLearning GD
mathjax: true
author: wzx
---

- ç›®å½•
{:toc}

éšç€è®­ç»ƒæ ·æœ¬æ•°é‡çš„æå‡ï¼Œæˆ‘ä»¬è®­ç»ƒåçš„æ¨¡å‹çš„è¡¨ç°ä¹Ÿè¶Šæ¥è¶Šå¥½ï¼Œä½†æ¯æ¬¡è¿­ä»£çš„æ—¶é—´ä¹Ÿä¸æ–­å¢åŠ ã€‚æˆ‘ä»¬ä¸»è¦é€šè¿‡ï¼Œå‡å°‘å®Œæˆä¸€æ¬¡å‚æ•°æ›´æ–°çš„æ ·æœ¬æ•°é‡ï¼Œä»¥åŠåˆ©ç”¨ç®—æ³•å°½é‡ä»æœ€çŸ­è·¯å¾„æ›´æ–°å‚æ•°ï¼Œæ¥ä¼˜åŒ–æ¢¯åº¦ä¸‹é™ç®—æ³•





## MBGD SGD BGD
- *Batch Gradient Descent*ï¼Œå³æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ã€‚æ¯æ¬¡è¿­ä»£å°†**æ‰€æœ‰**æ•°æ®ç”¨äºè®¡ç®—æ¢¯åº¦ï¼Œå¹¶æ›´æ–°å‚æ•°ã€‚è¿™ä¸ªåšæ³•ä¼˜ç‚¹ä¸ç¼ºç‚¹æ˜¾è€Œæ˜“è§ã€‚ä¼˜ç‚¹å°±æ˜¯æ ·æœ¬æ•°é‡å¤šï¼Œæ ·æœ¬å™ªå£°å°ï¼Œæˆæœ¬å‡½æ•°çš„ä¸‹é™æ›²çº¿ä¼šæ¯”è¾ƒå¹³æ»‘ï¼Œæœ€ç»ˆæˆ‘ä»¬çš„æ¨¡å‹å¯èƒ½ä¼šæ›´å¥½ã€‚ç¼ºç‚¹å°±æ˜¯**æ¯æ¬¡è¿­ä»£çš„æ—¶é—´å¤ªé•¿ï¼Œä¼šå—å†…å­˜é™åˆ¶ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¢åŠ è®­ç»ƒæ ·æœ¬**ã€‚ä½†åœ¨æ•°æ®é‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œæˆ‘è§‰å¾—æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•è¡¨ç°å¾—å¾ˆå¥½  


- *Stochastic Gradient Descent*ï¼Œå³éšæœºæ¢¯åº¦ä¸‹é™æ³•ã€‚è¿™ä¸ªå…¶å®ç›¸å½“äº *MBGD* ä¸­ *batch* ä¸º1çš„æƒ…å†µï¼Œå³æ¯æ¬¡åªè¿­ä»£ä¸€ä¸ªè®­ç»ƒæ ·æœ¬ã€‚è™½ç„¶ä¸æ˜¯æ¯æ¬¡è¿­ä»£å¾—åˆ°çš„æˆæœ¬å‡½æ•°éƒ½å‘ç€å…¨å±€æœ€ä¼˜æ–¹å‘ï¼Œä½†æ˜¯å¤§çš„æ–¹å‘æ˜¯é€æ¸è¶‹å‘å…¨å±€æœ€ä¼˜è§£çš„ï¼Œæœ€ç»ˆçš„ç»“æœå¾€å¾€æ˜¯åœ¨å…¨å±€æœ€ä¼˜è§£é™„è¿‘ï¼Œå¹¶åœ¨å‘¨å›´å¾˜å¾Š
![]({{ site.url }}/assets/img/2018-12-21-1.png)  


- *Mini-batch Gradient Descent*ï¼Œå³å°æ‰¹é‡æ‰¹æ¢¯åº¦ä¸‹é™æ³•ã€‚è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªè¶…å‚æ•° *batch*ã€‚å°†è®­ç»ƒæ ·æœ¬åˆ†æˆè®¸å¤šå°ä»½ï¼Œæ¯ä»½çš„å¤§å°å°±æ˜¯ *batch*ã€‚æ¯æ¬¡æ­£å‘å’Œåå‘ä¼ æ’­æ—¶ï¼Œå°±å¯¹è¿™äº›æ ·æœ¬è¿›è¡Œè¿­ä»£ã€‚æ¯å¯¹æ‰€æœ‰è®­ç»ƒæ ·æœ¬å®Œæˆä¸€æ¬¡è¿­ä»£ï¼Œåˆ™ç§°ä¸ºä¸€ä¸ª *Epoch*ã€‚*MBGD* å¤§å¹…é™ä½äº†æ¯æ¬¡è¿­ä»£çš„æ—¶é—´ã€‚è™½ç„¶æ¯æ¬¡è¿­ä»£çš„æ ·æœ¬å¹¶ä¸æ˜¯å…¨éƒ¨æ ·æœ¬ï¼Œæ•°æ®å­˜åœ¨å™ªå£°ï¼Œæ‰€ä»¥æˆæœ¬å‡½æ•°çš„ä¸‹é™æ›²çº¿ä¼šæœ‰äº›æ³¢åŠ¨ï¼Œä½†æ€»ä½“è¶‹åŠ¿ä¾ç„¶æ˜¯ä¸‹é™çš„  
![]({{ site.url }}/assets/img/2018-12-21-2.png)


## Momentum Gradient Descent
åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆæœ¬å‡½æ•°çš„å›¾åƒä¸æ˜¯é‚£ä¹ˆè§„åˆ™ï¼Œæ¢¯åº¦ä¸‹é™å¯èƒ½ä¼šèµ°å¾ˆå¤šâ€œå¼¯è·¯â€ã€‚å¦‚æœä½¿ç”¨ *MBGD* æˆ– *SGD* ï¼Œé‚£æ¢¯åº¦ä¸‹é™çš„æ–¹å‘åˆ™ä¼šæ›´åŠ æ³¢åŠ¨

### æŒ‡æ•°åŠ æƒå¹³å‡
#### åŸç†
å½“æˆ‘ä»¬è¦è®¡ç®—ä¸€ç»„æ•°çš„å¹³å‡å€¼æ—¶ï¼Œé€šå¸¸åšæ³•æ˜¯å°†è¿™äº›æ•°æ±‚å’Œå¹¶ä¸”é™¤ä»¥ä¸ªæ•°ï¼Œä½†å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ä¸”è®¡ç®—æ¬¡æ•°æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œè¿™æ ·çš„è®¡ç®—å°±å ç”¨è¾ƒå¤šèµ„æºã€‚*æŒ‡æ•°åŠ æƒå¹³å‡* æœ¬è´¨æ˜¯**ä»¥æŒ‡æ•°å¼é€’å‡åŠ æƒçš„ç§»åŠ¨å¹³å‡**ã€‚é€šè¿‡é€’æ¨çš„å½¢å¼ï¼Œå„æ•°å€¼çš„åŠ æƒéšæ—¶é—´è€ŒæŒ‡æ•°å¼é€’å‡ï¼Œè¶Šè¿‘æœŸçš„æ•°æ®åŠ æƒè¶Šé‡ï¼Œä½†è¾ƒæ—§çš„æ•°æ®ä¹Ÿç»™äºˆä¸€å®šçš„åŠ æƒã€‚**é€šè¿‡è°ƒæ•´è¶…å‚æ•° $\beta$ çš„å€¼ï¼Œå¯ä»¥è°ƒæ•´å¯¹å†å²æ•°æ®çš„æƒé‡**
- $V_t$ ï¼š å½“å‰æŒ‡æ•°åŠ æƒå¹³å‡å€¼
- $\theta_t$  ï¼š å½“å‰æ•°æ®å€¼   

$$
\begin{equation}
\begin{aligned}
V_0&=0
\\V_1&=\beta V_{0}+(1-\beta)\theta_1
\\V_2&=\beta V_{1}+(1-\beta)\theta_2
\\ &\cdots
\\V_t&=\beta V_{t-1}+(1-\beta)\theta_t

\end{aligned}
\end{equation}
$$

#### åå·®ä¿®æ­£
å¤§å®¶å¯èƒ½ä¼šå‘ç°ï¼Œå› ä¸º $V_0$ çš„å€¼ä¸º0ï¼Œè¿™å¯¹**æœ€åˆ**çš„ä¸€äº›å¹³å‡å€¼äº§ç”Ÿæ¯”è¾ƒå¤§çš„å½±å“ï¼Œä¸ºäº†æ¶ˆé™¤è¿™ä¸ªå½±å“ï¼Œæˆ‘ä»¬å¯¹å…¬å¼åšä¸€äº›ä¿®æ”¹

$$
V_t^{corrected}=\frac{V_t}{1-\beta^t}=\frac{\beta V_{t-1}+(1-\beta)\theta_t}{1-\beta^t}
$$

éšç€ t çš„å¢å¤§ï¼Œåå·®ä¿®æ­£é¡¹çš„å€¼è¶Šæ¥è¶Šæ¥è¿‘ 1 ï¼Œæ‰€ä»¥è¯¥åå·®ä¿®æ­£é¡¹å¯¹æ•°æ®å‰æœŸå½±å“å¤§ï¼ŒåæœŸå½±å“å°

### åŸç†
åŠ¨é‡æ¢¯åº¦ä¸‹é™åˆ©ç”¨**æŒ‡æ•°åŠ æƒå¹³å‡**ï¼Œç»¼åˆäº†å†å²çš„æ¢¯åº¦ä»¥å¹³æ»‘æœ¬æ¬¡æ›´æ–°çš„æ¢¯åº¦ã€‚æ¯æ¬¡æ›´æ–°çš„æ¢¯åº¦å°†ä¸æ˜¯ç‹¬ç«‹çš„æƒ…å†µï¼Œè€Œæ˜¯æ‹¥æœ‰ä¸€å®šæƒé‡çš„å†å²æ¢¯åº¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²æ˜¾ç¤ºäº†å†å²çš„æ¢¯åº¦ä¸‹é™çš„æ–¹å‘å‡å€¼ï¼Œè“è‰²è¡¨ç¤ºåŸå§‹æ¢¯åº¦æ–¹å‘ï¼Œçº¢è‰²ç®­å¤´ä¸ºåˆæˆçš„æ–¹å‘
![]({{ site.url }}/assets/img/2018-12-21-3.png)

### å®ç°
ç›¸å¯¹æ¢¯åº¦ä¸‹é™æ¥è¯´ï¼Œåœ¨å‚æ•°æ›´æ–°ä»¥åŠæ¢¯åº¦è®¡ç®—æ—¶æœ‰æ‰€ä¸åŒï¼Œä¸ºäº†ç®€æ´ï¼Œå°† $\frac{\partial{J}}{\partial{W^{[l]}}}$ ç®€å†™ä¸º $dW^{[l]}$

$$
\begin{equation}
\begin{cases}
V_{dW^{[l]}}=\beta V_{dW^{[l-1]}}+(1-\beta)dW^{[l]}
\\ W^{[l]}:=W^{[l]}-\alpha V_{dW^{[l]}}
\end{cases}
\\
\begin{cases}
V_{db^{[l]}}=\beta V_{db^{[l-1]}}+(1-\beta)db^{[l]}
\\ b^{[l]}:=b^{[l]}-\alpha V_{db^{[l]}}
\end{cases}
\end{equation}
$$

> ä¸€èˆ¬æ¥è¯´ ğ›½ ä» 0.8~0.999 èŒƒå›´å†…å–å€¼ã€‚å»ºè®®å– 0.9

## RMSprop
### åŸç†
é€šè¿‡å…¨å±€å­¦ä¹ ç‡é€å‚æ•°çš„é™¤ä»¥ç»è¿‡è¶…å‚æ•° $\beta$ æ§åˆ¶çš„å†å²æ¢¯åº¦å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼Œä½¿å¾—æ¯ä¸ªå‚æ•°çš„å­¦ä¹ ç‡ä¸åŒï¼Œæ¢¯åº¦å¤§çš„å‚æ•°å­¦ä¹ ç‡ä¼šé™ä½ã€‚è¿™æ ·å°±ä½¿å¾—å‚æ•°æ¢¯åº¦çš„å¹³ç¼“æ–¹å‘ï¼Œå–å¾—æ›´å¤§çš„è¿›æ­¥ï¼Œè€Œé™¡å³­çš„æ–¹å‘åˆ™ä¼šå˜å¾—å¹³ç¼“ï¼Œä»è€ŒåŠ å¿«è®­ç»ƒé€Ÿåº¦
### å®ç°
ä¸ºäº†ç®€æ´ï¼Œå°† $\frac{\partial{J}}{\partial{W^{[l]}}}$ ç®€å†™ä¸º $dW^{[l]}$

$$
\begin{equation}
\begin{cases}
S_{dW^{[l]}}=\beta S_{dW^{[l-1]}}+(1-\beta)(dW^{[l]})^2
\\ W^{[l]}:=W^{[l]}-\frac{\alpha}{\sqrt{S_{dW^{[l]}}}+\epsilon}dW^{[l]}
\end{cases}
\\
\begin{cases}
S_{db^{[l]}}=\beta S_{db^{[l-1]}}+(1-\beta)(db^{[l]})^2
\\ b^{[l]}:=b^{[l]}-\frac{\alpha}{\sqrt{S_{db^{[l]}}}+\epsilon}db^{[l]}
\end{cases}
\end{equation}
$$

> $\epsilon$ ä¸ºä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œä¸ºäº†é˜²æ­¢å‡ºç°åˆ†æ¯ä¸º 0 çš„æƒ…å†µï¼Œä¸€èˆ¬å–å€¼ä¸º $10^{-8}$ ã€‚$\beta$ ä¸€èˆ¬å– 0.999

## Adam
*Adaptive Moment Estimation*ï¼Œè‡ªé€‚åº”çŸ©ä¼°è®¡ç»¼åˆäº† *Momentum Gradient Descent* ä¸ *RMSprop*ï¼Œä¸ä¸¤è€…ç»“åˆä½“ç±»ä¼¼ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºå…¬å¼ï¼Œä¸ºäº†ç®€æ´ï¼Œå°† $\frac{\partial{J}}{\partial{W^{[l]}}}$ ç®€å†™ä¸º $dW^{[l]}$

$$
\begin{equation}
\begin{cases}
V_{dW^{[l]}}=\beta_1 V_{dW^{[l-1]}}+(1-\beta_1)dW^{[l]}
\\ V_{dW^{[l]}}^{corrected}=\frac{V_{dW^{[l]}}}{1-(\beta_1)^t}
\\ S_{dW^{[l]}}=\beta_2 S_{dW^{[l-1]}}+(1-\beta_2)(dW^{[l]})^2
\\ S_{dW^{[l]}}^{corrected}=\frac{S_{dW^{[l]}}}{1-(\beta_2)^t}
\\ W^{[l]}:=W^{[l]}-\frac{\alpha}{\sqrt{S^{corrected}_{dW^{[l]}}}+\epsilon}
\end{cases}
\\
\begin{cases}
V_{db^{[l]}}=\beta_1 V_{db^{[l-1]}}+(1-\beta_1)db^{[l]}
\\ V_{db^{[l]}}^{corrected}=\frac{V_{db^{[l]}}}{1-(\beta_1)^t}
\\ S_{db^{[l]}}=\beta_2 S_{db^{[l-1]}}+(1-\beta_2)(db^{[l]})^2
\\ S_{db^{[l]}}^{corrected}=\frac{S_{db^{[l]}}}{1-(\beta_2)^t}
\\ b^{[l]}:=b^{[l]}-\frac{\alpha}{\sqrt{S^{corrected}_{db^{[l]}}}+\epsilon}
\end{cases}
\end{equation}
$$

## æ€»ç»“
å„ç§ä¼˜åŒ–ç®—æ³•å¯¹æ¯”

![]({{ site.url }}/assets/img/2018-12-21-4.gif)
![]({{ site.url }}/assets/img/2018-12-21-5.gif)
